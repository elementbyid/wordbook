<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jgji.spring.domain.word.repository.WordMapper">
    <select id="findAllByUserId" parameterType="string" resultType="word">
        SELECT            
            w.id
            , w.word
            , w.meaning
            , w.next_date as nextDate
        FROM              
            Word w        
        WHERE             
            w.users_id = ${id}
    </select>
    
     <select id="findToDayWordListByUserId" parameterType="hashmap" resultType="word">
     <![CDATA[
        SELECT                      
            *                       
        FROM                        
            Word w                  
        WHERE
            w.users_id = ${id}
        AND                         
            w.next_date <= #{date}
      ]]>               
      </select>
      
      
      <select id="findWordListByUserIdAndWordId" parameterType="list" resultType="word">
            SELECT            
                *             
            FROM              
                Word w        
            WHERE             
                w.id IN
            <foreach collection="list" item="id" index="idx" separator=","
            open="(" close=")">
                ${id}
            </foreach>
        </select>
        
        <update id="updateSuccessWord" parameterType="word">
            UPDATE
                Word
            SET
                next_date = #{nextDate}
                , level = ${level}
            WHERE
                id = ${id}
        </update>
        
        <insert id="insertBatchWord">
            INSERT INTO WORD(word, meaning, next_date, users_id)
            VALUES
            <foreach collection="list" item="word" index="idx">
                <if test="idx > 0"> , </if>
                (#{word.word}, #{word.meaning}, #{word.nextDate}, ${word.usersId})
            </foreach>
        </insert>
        
        <delete id="delete">
            DELETE FROM Word
            WHERE id IN
            <foreach collection="list" item="id" separator=","
            open="(" close=")">
                ${id}
            </foreach>
        </delete>
</mapper>