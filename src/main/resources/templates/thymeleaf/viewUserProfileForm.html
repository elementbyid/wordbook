<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:th="http://www.thymeleaf.org" 
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
    layout:decorator="layout/default">
    
    <th:block layout:fragment="content">
        <h1> 유저 정보 Form </h1>
        <table class="table table-striped" th:object="${user}">
          <tr>
            <th th:text="#{word.profile.name}">Name</th>
            <td><b th:text="*{username}"></b></td>
          </tr>
        </table>
        
        <ul id="tab_1" class="tab top">
            <li>
                <a href="#home">단어 목록</a>
            </li>
            <li><a href="#css">그래프</a></li>
            <li><a href="#script">Script</a></li>
        </ul>
        
        <div id="tab_contents_1">
            <div id="home">
                <button type="button" id="delete" class="btn btn-danger" onclick="rowDelete()" style="float:right" disabled >Delete</button>
                <br />
                <br />
                <table id="table_8" class="table classic">
                    <thead>
                    <tr>
                        <th width="50px">No</th>
                        <th th:text="#{word.profile.word}"> 단어</th>
                        <th th:text="#{word.profile.meaning}">뜻</th>
                        <th th:text="#{word.profile.nextdate}">다음 시험 일자</th>
                        <th style="display: none"> ID </th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="css">
                <div id="result" style="position: relative; user-select: none;" unselectable="on">
                </div>
            </div>
            <div id="script">script
            </div>
        </div>
    
        <style>
            #tab_1 a {
                padding: 10px 25px;
            }
            * {
                box-sizing: initial;
            }
        </style>
        <link th:href="@{/css/tab.css}" rel="stylesheet" type="text/css">
        <link rel="stylesheet" th:href="@{/lib/jui/dist/ui-jennifer.min.css}" />
        <!-- Grid style components -->
        <link rel="stylesheet" th:href="@{/lib/jui-grid/dist/grid-jennifer.css}" />
        
        <!-- Required script files -->
        <script th:src="@{/lib/jui-core/dist/core.min.js}"></script>
        
        <!-- Basic script components -->
        <script th:src="@{/lib/jui/dist/ui.min.js}"></script>
                
        <!-- Grid script components -->
        <script th:src="@{/lib/jui-grid/dist/grid.js}"></script>
        <script th:src="@{/lib/juijs-chart/dist/jui-chart.js}"></script>

         <script id="tpl_row" data-jui="#table_8" data-tpl="row" type="text/template">
             <tr style="cursor: pointer;">
                 <td><!= row.index !></td>
                 <td><!= word !></td>
                 <td><!= meaning !></td>
                 <td><!= nextDate !></td>
                 <td style="display: none"><!= id !></td>
             </tr>
         </script>
         
         <script th:inline="javascript">
            /* <![CDATA[ */
            	function rowDelete() {
            		const rowIds = [];
            		let removeTr = [];
            		const row = document.querySelectorAll("tr.checked");
            		
            		for (i = 0; i < row.length; i++) {
            			const tr = row[i];
            			removeTr.push(row[i]);
            			
            			rowIds.push(tr.cells[4].textContent)
            		}
            		
            		 const data = JSON.stringify(rowIds);
            		 $.ajax({
                         type:"DELETE"
                         , contentType: "application/json"
                         , url: "/word/delete"
                         , data: data
                         , dataType : 'json'
                         , cache: false
                         , success: function(data) {
                        	 alert(data);
                         }
                         , complete : function() {
                        	 for (i = 0; i < removeTr.length; i++) {
                        		 removeTr[i].remove();
                        	 }
                         }
                     });
        	    }
            	
                jui.ready([ "grid.table" ], function(table) {
                    table_8 = table("#table_8", {
                        fields: [ null, "word", "meaning", "nextDate", "id"],
                        data: [(${data})],
                        editRow: [ "meaning" ],
                        resize: true,
                        sort: true,
                        event: {
                            editend: function(row) {
                                let data = JSON.stringify(row.data);
                                
                                 $.ajax({
                                     type:"POST"
                                     , contentType: "application/json; charset=UTF-8"
                                     , url: "/word/update"
                                     , data: data
                                     , dataType : 'json'
                                     , cache: false
                                     , success: function(data) {
                                         if (data) {
                                        	 alert("수정 완료");
                                         }
                                     }
                                 });
                            },
                            click: function(row, e) {
                                if($(row.element).hasClass("checked")) {
                                    this.uncheck(row.index);
                                    
                                    const checkedRow = document.querySelectorAll("tr.checked");
                                    
                                    if (checkedRow.length === 0) {
                                    	document.querySelector("#delete").setAttribute("disabled", "disabled");
                                    }
                                    
                                } else {
                                    this.check(row.index);
                                    document.querySelector("#delete").removeAttribute("disabled");
                                }
                            }
                        },
                        tpl: {
                            row: $("#tpl_row").html()
                        }
                    });
                });
                
                jui.ready([ "ui.tab" ], function(tab) {
                	tab_1 = tab("#tab_1", {
                        event: {
                            change: function(data) {
                            }
                        },
                        target: "#tab_contents_1",
                        index: 0
                    });
                });
                
                graph.ready([ "chart.builder" ], function(builder) {
                	var data = [
                	    { quarter : "01", sales : 50 },
                	    { quarter : "02", sales : 20 },
                	    { quarter : "03", sales : 10 },
                	    { quarter : "04", sales : 30 },
                	    { quarter : "05", sales : 44 },
                	    { quarter : "06", sales : 22 },
                	    { quarter : "07", sales : 21 },
                	    { quarter : "08", sales : 36 },
                	    { quarter : "09", sales : 56 },
                	    { quarter : "10", sales : 30 },
                	];

                	builder("#result", {
                		width: 1000,
                        height : 600,
                	    axis : [{
                	        x : {
                	            type : "range",
                	            domain : "sales",
                	            step : 10,
                	            line : true
                	        },
                	        y : {
                	            type : "block",
                	            domain : "quarter",
                	            line : true
                	        },
                	        data : data
                	    }],
                	    brush : [{
                	        type : "bar",
                	        target : "sales",
                	        display : "max",
                	        activeEvent : "mouseover",
                	        animate : true
                	    }],
                	    widget : [{
                	        type : "title",
                	        text : "Bar Sample",
                	        align : "start"
                	    }]
                	});
                });
  
           /* ]]> */
    </script>
    </th:block>
    
</html>