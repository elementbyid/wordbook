<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:th="http://www.thymeleaf.org" 
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
    layout:decorator="layout/default">
    
    <th:block layout:fragment="content">
        <h1> 유저 정보 Form </h1>
        <table class="table table-striped" th:object="${user}">
          <tr>
            <th>Name</th>
            <td><b th:text="*{username}"></b></td>
          </tr>
        </table>
        
        <button type="button" class="btn btn-danger" onclick="rowDelete()" style="float:right">Delete</button>
        <br />
        <br />
        <table id="table_8" class="table classic">
            <thead>
            <tr>
                <th width="50px">No</th>
                <th>단어</th>
                <th>뜻</th>
                <th>다음 시험 일자</th>
                <th style="display: none"> ID </th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    
        <!-- Grid style components -->
        <link rel="stylesheet" th:href="@{/lib/jui-grid/dist/grid-jennifer.css}" />
        
        <!-- Required script files -->
        <script th:src="@{/lib/jui-core/dist/core.min.js}"></script>
        
        <!-- Basic script components -->
        <script th:src="@{/lib/jui/dist/ui.min.js}"></script>
                
        <!-- Grid script components -->
        <script th:src="@{/lib/jui-grid/dist/grid.js}"></script>

         <script id="tpl_row" data-jui="#table_8" data-tpl="row" type="text/template">
             <tr style="cursor: pointer;">
                 <td><!= row.index !></td>
                 <td><!= word !></td>
                 <td><!= meaning !></td>
                 <td><!= nextDate !></td>
                 <td style="display: none"><!= id !></td>
             </tr>
         </script>
         <script th:inline="javascript">
            /* <![CDATA[ */
            	function rowDelete() {
            		const rowIds = [];
            		let removeTr = [];
            		const row = document.querySelectorAll("tr.checked");
            		for (i = 0; i < row.length; i++) {
            			const tr = row[i];
            			removeTr.push(row[i]);
            			
            			rowIds.push(tr.cells[4].textContent)
            		}
            		
            		 const data = JSON.stringify(rowIds);
            		 $.ajax({
                         type:"DELETE"
                         , contentType: "application/json"
                         , url: "/word/delete"
                         , data: data
                         , dataType : 'json'
                         , cache: false
                         , success: function(data) {
                        	 alert(data);
                         }
                         , complete : function() {
                        	 for (i = 0; i < removeTr.length; i++) {
                        		 removeTr[i].remove();
                        	 }
                         }
                     });
        	    }
            	
                jui.ready([ "grid.table" ], function(table) {
                table_8 = table("#table_8", {
                    fields: [ null, "word", "meaning", "nextDate", "id"],
                    data: [(${data})],
                    editRow: [ "meaning" ],
                    resize: true,
                    sort: true,
                    event: {
                        editend: function(row) {
                            let data = JSON.stringify(row.data);
                             $.ajax({
                                 type:"POST"
                                 , contentType: "application/json; charset=UTF-8"
                                 , url: "/word/update"
                                 , data: data
                                 , dataType : 'json'
                                 , cache: false
                                 , success: function(data) {
                                     alert(data);
                                 }
                             });
                        },
                        click: function(row, e) {
                            if($(row.element).hasClass("checked")) {
                                this.uncheck(row.index);
                            } else {
                                this.check(row.index);
                            }
                        }
                    },
                    tpl: {
                        row: $("#tpl_row").html()
                    }
                });
            });
  
           /* ]]> */
    </script>
    </th:block>
    
</html>